{"ast":null,"code":"import _toConsumableArray from\"/home/dmitrij/dev/react-mesto-auth/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/home/dmitrij/dev/react-mesto-auth/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from'react';import{Route,Switch,useHistory}from'react-router-dom';import Header from'./Header';import Main from'./Main';import Footer from'./Footer';import ImagePopup from'./ImagePopup';import EditProfilePopup from'./EditProfilePopup';import EditAvatarPopup from'./EditAvatarPopup';import AddPlacePopup from'./AddPlacePopup';import{CurrentUserContext}from'../contexts/CurrentUserContext';import api from'../utils/Api';import Register from'./Register';import Login from'./Login';import{register,authorize,getContent}from'../auth';import ProtectedRoute from'./ProtectedRoute';import InfoTooltip from'./InfoTooltip';function App(){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),loggedIn=_useState2[0],setLoggedIn=_useState2[1];var _useState3=useState({email:''}),_useState4=_slicedToArray(_useState3,2),userData=_useState4[0],setUserData=_useState4[1];var history=useHistory();useEffect(function(_){tokenCheck();},[]);var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isEditProfilePopupOpen=_useState6[0],setEditProfilePopupOpen=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),isAddPlacePopupOpen=_useState8[0],setAddPlacePopupOpen=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),isEditAvatarPopupOpen=_useState10[0],setEditAvatarPopupOpen=_useState10[1];var _useState11=useState({}),_useState12=_slicedToArray(_useState11,2),selectedCard=_useState12[0],setSelectedCard=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),isCardPopupOpen=_useState14[0],setCardPopupOpen=_useState14[1];var _useState15=useState({}),_useState16=_slicedToArray(_useState15,2),currentUser=_useState16[0],setcurrentUser=_useState16[1];var _useState17=useState([]),_useState18=_slicedToArray(_useState17,2),cards=_useState18[0],getCards=_useState18[1];var _useState19=useState({message:'',success:Boolean,open:false}),_useState20=_slicedToArray(_useState19,2),infoTooltipState=_useState20[0],setInfoTooltipState=_useState20[1];useEffect(function(){api.getInitialCards().then(function(data){var items=data.map(function(el){return{_id:el._id,name:el.name,link:el.link,likes:el.likes,owner:el.owner};});getCards(items);}).catch(function(err){return console.log(err);});},[]);useEffect(function(){api.getUserInfo().then(function(data){setcurrentUser(data);}).catch(function(err){return console.log(err);});},[]);function handleCardClick(card){setCardPopupOpen(true);setSelectedCard(card);}function handleEditProfileClick(){setEditProfilePopupOpen(true);}function handleEditAvatarClick(){setEditAvatarPopupOpen(true);}function handleAddPlaceClick(){setAddPlacePopupOpen(true);}function closeAllPopups(){setEditAvatarPopupOpen(false);setAddPlacePopupOpen(false);setEditProfilePopupOpen(false);setCardPopupOpen(false);setInfoTooltipState({open:false});}function handleCardDelete(id){api.deleteCard(id).then(function(){getCards(cards.filter(function(card){return card._id!==id;}));}).catch(function(err){return console.log(err);});}function handleCardDislike(id){api.removeLike(id).then(function(newCard){var newCards=cards.map(function(c){return c._id===id?newCard:c;});getCards(newCards);}).catch(function(err){return console.log(err);});}function handleCardLike(id){api.putLike(id).then(function(newCard){var newCards=cards.map(function(c){return c._id===id?newCard:c;});getCards(newCards);}).catch(function(err){return console.log(err);});}function handleUpdateUser(newData){api.patchUserInfo(newData).then(function(data){setcurrentUser(data);closeAllPopups();}).catch(function(err){return console.log(err);});}function handleUpdateAvatar(newAvatar){api.patchAvatar(newAvatar).then(function(data){setcurrentUser(data);closeAllPopups();}).catch(function(err){return console.log(err);});}function handleAddPlaceSubmit(newCard){api.postCard(newCard).then(function(data){getCards([].concat(_toConsumableArray(cards),[data]));closeAllPopups();}).catch(function(err){return console.log(err);});}var handleLogin=function handleLogin(email,password){authorize(email,password).then(function(data){if(data.token){localStorage.setItem('jwt',data.token);tokenCheck();}}).catch(function(err){return console.error(err);});};var handleLogout=function handleLogout(){localStorage.removeItem('jwt');setUserData({email:''});setLoggedIn(false);};var handleRegister=function handleRegister(email,password){register(email,password).then(function(data){console.log(data);if(data.data._id){setInfoTooltipState({message:'Вы успешно зарегистрировались!',success:true,open:true});history.push('/sign-in');}}).catch(function(err){console.log(err);setInfoTooltipState({message:'Что-то пошло не так! Попробуйте ещё раз.',success:false,open:true});});};var tokenCheck=function tokenCheck(){var jwt=localStorage.getItem('jwt');if(jwt){getContent(jwt).then(function(res){if(res.data.email){setUserData({email:res.data.email});setLoggedIn(true);history.push('/');}}).catch(function(err){return console.error(err);});}};return/*#__PURE__*/React.createElement(CurrentUserContext.Provider,{value:currentUser},/*#__PURE__*/React.createElement(\"div\",{className:\"page\"},/*#__PURE__*/React.createElement(\"div\",{className:\"page__content\"},/*#__PURE__*/React.createElement(Header,{loggedIn:loggedIn,userData:userData,logout:handleLogout}),/*#__PURE__*/React.createElement(Switch,null,/*#__PURE__*/React.createElement(Route,{exact:true,path:\"/sign-in\"},/*#__PURE__*/React.createElement(Login,{handleLogin:handleLogin})),/*#__PURE__*/React.createElement(Route,{exact:true,path:\"/sign-up\"},/*#__PURE__*/React.createElement(Register,{handleRegister:handleRegister})),/*#__PURE__*/React.createElement(ProtectedRoute,{exact:true,path:\"/\",loggedIn:loggedIn,component:Main,onEditAvatar:handleEditAvatarClick,onEditProfile:handleEditProfileClick,onAddPlace:handleAddPlaceClick,onCardClick:handleCardClick,onCardDelete:handleCardDelete,onCardLike:handleCardLike,onCardDislike:handleCardDislike,cards:cards})),/*#__PURE__*/React.createElement(EditProfilePopup,{isOpen:isEditProfilePopupOpen,onClose:closeAllPopups,onUpdateUser:handleUpdateUser}),/*#__PURE__*/React.createElement(EditAvatarPopup,{isOpen:isEditAvatarPopupOpen,onClose:closeAllPopups,onUpdateAvatar:handleUpdateAvatar}),/*#__PURE__*/React.createElement(AddPlacePopup,{isOpen:isAddPlacePopupOpen,onClose:closeAllPopups,onAddPlace:handleAddPlaceSubmit}),/*#__PURE__*/React.createElement(ImagePopup,{card:selectedCard,isOpen:isCardPopupOpen,onClose:closeAllPopups}),/*#__PURE__*/React.createElement(InfoTooltip,{onClose:closeAllPopups,renderState:infoTooltipState}),/*#__PURE__*/React.createElement(Footer,null))));}export default App;","map":{"version":3,"sources":["/home/dmitrij/dev/react-mesto-auth/src/components/App.js"],"names":["React","useState","useEffect","Route","Switch","useHistory","Header","Main","Footer","ImagePopup","EditProfilePopup","EditAvatarPopup","AddPlacePopup","CurrentUserContext","api","Register","Login","register","authorize","getContent","ProtectedRoute","InfoTooltip","App","loggedIn","setLoggedIn","email","userData","setUserData","history","_","tokenCheck","isEditProfilePopupOpen","setEditProfilePopupOpen","isAddPlacePopupOpen","setAddPlacePopupOpen","isEditAvatarPopupOpen","setEditAvatarPopupOpen","selectedCard","setSelectedCard","isCardPopupOpen","setCardPopupOpen","currentUser","setcurrentUser","cards","getCards","message","success","Boolean","open","infoTooltipState","setInfoTooltipState","getInitialCards","then","data","items","map","el","_id","name","link","likes","owner","catch","err","console","log","getUserInfo","handleCardClick","card","handleEditProfileClick","handleEditAvatarClick","handleAddPlaceClick","closeAllPopups","handleCardDelete","id","deleteCard","filter","handleCardDislike","removeLike","newCard","newCards","c","handleCardLike","putLike","handleUpdateUser","newData","patchUserInfo","handleUpdateAvatar","newAvatar","patchAvatar","handleAddPlaceSubmit","postCard","handleLogin","password","token","localStorage","setItem","error","handleLogout","removeItem","handleRegister","push","jwt","getItem","res"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { Route, Switch, useHistory } from 'react-router-dom';\nimport Header from './Header';\nimport Main from './Main';\nimport Footer from './Footer';\nimport ImagePopup from './ImagePopup'\nimport EditProfilePopup from './EditProfilePopup'\nimport EditAvatarPopup from './EditAvatarPopup'\nimport AddPlacePopup from './AddPlacePopup'\nimport { CurrentUserContext } from '../contexts/CurrentUserContext'\nimport api from '../utils/Api'\nimport Register from './Register';\nimport Login from './Login';\nimport { register, authorize, getContent } from '../auth';\nimport ProtectedRoute from './ProtectedRoute';\nimport InfoTooltip from './InfoTooltip';\n\nfunction App() {\n\n  const [loggedIn, setLoggedIn] = useState(false)\n  const [userData, setUserData] = useState({\n    email: ''\n  })\n\n  const history = useHistory();\n\n  useEffect(_ => {\n    tokenCheck()\n  }, [])\n\n  const [isEditProfilePopupOpen, setEditProfilePopupOpen] = useState(false)\n  const [isAddPlacePopupOpen, setAddPlacePopupOpen] = useState(false)\n  const [isEditAvatarPopupOpen, setEditAvatarPopupOpen] = useState(false)\n  const [selectedCard, setSelectedCard] = useState({});\n  const [isCardPopupOpen, setCardPopupOpen] = useState(false)\n  const [currentUser, setcurrentUser] = useState({})\n  const [cards, getCards] = useState([])\n  const [infoTooltipState, setInfoTooltipState] = useState({\n    message: '',\n    success: Boolean,\n    open: false\n  });\n\n  useEffect(() => {\n    api.getInitialCards()\n      .then((data) => {\n        const items = data.map((el) => ({\n          _id: el._id,\n          name: el.name,\n          link: el.link,\n          likes: el.likes,\n          owner: el.owner\n        }))\n        getCards(items);\n      })\n      .catch(err => console.log(err))\n  }, [])\n\n  useEffect(() => {\n    api.getUserInfo()\n      .then((data) => {\n        setcurrentUser(data)\n      })\n      .catch(err => console.log(err))\n  }, [])\n\n  function handleCardClick(card) {\n    setCardPopupOpen(true)\n    setSelectedCard(card)\n  }\n\n  function handleEditProfileClick() {\n    setEditProfilePopupOpen(true)\n  }\n\n  function handleEditAvatarClick() {\n    setEditAvatarPopupOpen(true)\n  }\n\n  function handleAddPlaceClick() {\n    setAddPlacePopupOpen(true)\n  }\n\n  function closeAllPopups() {\n    setEditAvatarPopupOpen(false)\n    setAddPlacePopupOpen(false)\n    setEditProfilePopupOpen(false)\n    setCardPopupOpen(false)\n    setInfoTooltipState({\n      open: false\n    })\n  }\n\n  function handleCardDelete(id) {\n    api.deleteCard(id)\n      .then(() => {\n        getCards(cards.filter(card => card._id !== id))\n      })\n      .catch(err => console.log(err))\n  }\n\n  function handleCardDislike(id) {\n    api.removeLike(id)\n      .then((newCard) => {\n        const newCards = cards.map((c) => c._id === id ? newCard : c);\n        getCards(newCards);\n      })\n      .catch(err => console.log(err))\n  }\n\n  function handleCardLike(id) {\n    api.putLike(id)\n      .then((newCard) => {\n        const newCards = cards.map((c) => c._id === id ? newCard : c);\n        getCards(newCards);\n      })\n      .catch(err => console.log(err))\n  }\n\n  function handleUpdateUser(newData) {\n    api.patchUserInfo(newData)\n      .then((data) => {\n        setcurrentUser(data)\n        closeAllPopups()\n      })\n      .catch(err => console.log(err))\n  }\n\n  function handleUpdateAvatar(newAvatar) {\n    api.patchAvatar(newAvatar)\n      .then((data) => {\n        setcurrentUser(data)\n        closeAllPopups()\n      })\n      .catch(err => console.log(err))\n  }\n\n  function handleAddPlaceSubmit(newCard) {\n    api.postCard(newCard)\n      .then((data) => {\n        getCards([...cards, data]);\n        closeAllPopups()\n      })\n      .catch(err => console.log(err))\n  }\n\n  const handleLogin = (email, password) => {\n    authorize(email, password)\n      .then(data => {\n        if (data.token) {\n          localStorage.setItem('jwt', data.token)\n          tokenCheck()\n        }\n      })\n      .catch(err => console.error(err))\n  }\n\n  const handleLogout = () => {\n    localStorage.removeItem('jwt');\n    setUserData({\n      email: ''\n    })\n    setLoggedIn(false)\n  }\n\n  const handleRegister = (email, password) => {\n    register(email, password)\n      .then(data => {\n        console.log(data)\n        if (data.data._id) {\n          setInfoTooltipState({\n            message: 'Вы успешно зарегистрировались!',\n            success: true,\n            open: true\n          })\n          history.push('/sign-in')\n        }\n      })\n      .catch(err => {\n        console.log(err)\n        setInfoTooltipState({\n          message: 'Что-то пошло не так! Попробуйте ещё раз.',\n          success: false,\n          open: true\n        })\n      })\n\n  }\n\n  const tokenCheck = () => {\n    const jwt = localStorage.getItem('jwt');\n    if (jwt) {\n      getContent(jwt)\n        .then((res) => {\n          if (res.data.email) {\n            setUserData({\n              email: res.data.email\n            })\n            setLoggedIn(true)\n            history.push('/')\n          }\n        }).catch(err => console.error(err))\n    }\n  }\n\n  return (\n    <CurrentUserContext.Provider value={currentUser}>\n      <div className='page'>\n        <div className=\"page__content\">\n          <Header\n            loggedIn={loggedIn}\n            userData={userData}\n            logout={handleLogout}\n          />\n          <Switch>\n            <Route exact path=\"/sign-in\">\n              <Login handleLogin={handleLogin} />\n            </Route>\n            <Route exact path=\"/sign-up\">\n              <Register handleRegister={handleRegister} />\n            </Route>\n            <ProtectedRoute exact path=\"/\"\n              loggedIn={loggedIn}\n              component={Main}\n              onEditAvatar={handleEditAvatarClick}\n              onEditProfile={handleEditProfileClick}\n              onAddPlace={handleAddPlaceClick}\n              onCardClick={handleCardClick}\n              onCardDelete={handleCardDelete}\n              onCardLike={handleCardLike}\n              onCardDislike={handleCardDislike}\n              cards={cards}\n            />\n          </Switch>\n          <EditProfilePopup\n            isOpen={isEditProfilePopupOpen}\n            onClose={closeAllPopups}\n            onUpdateUser={handleUpdateUser}\n          />\n          <EditAvatarPopup\n            isOpen={isEditAvatarPopupOpen}\n            onClose={closeAllPopups}\n            onUpdateAvatar={handleUpdateAvatar}\n          />\n          <AddPlacePopup\n            isOpen={isAddPlacePopupOpen}\n            onClose={closeAllPopups}\n            onAddPlace={handleAddPlaceSubmit}\n          />\n          <ImagePopup\n            card={selectedCard}\n            isOpen={isCardPopupOpen}\n            onClose={closeAllPopups}\n          />\n          <InfoTooltip\n            onClose={closeAllPopups}\n            renderState={infoTooltipState}\n          />\n          <Footer />\n        </div>\n      </div>\n    </CurrentUserContext.Provider>\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}