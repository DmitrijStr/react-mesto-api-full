{"ast":null,"code":"import _toConsumableArray from\"/home/dmitrij/dev/react-mesto-api-full/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/home/dmitrij/dev/react-mesto-api-full/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from'react';import{Route,Switch,useHistory}from'react-router-dom';import Header from'./Header';import Main from'./Main';import Footer from'./Footer';import ImagePopup from'./ImagePopup';import EditProfilePopup from'./EditProfilePopup';import EditAvatarPopup from'./EditAvatarPopup';import AddPlacePopup from'./AddPlacePopup';import{CurrentUserContext}from'../contexts/CurrentUserContext';import api from'../utils/Api';import Register from'./Register';import Login from'./Login';import{register,authorize,getContent,getInitialCards,postCard,patchUserInfo,patchAvatar,putLike,removeLike,deleteCard}from'../auth';import ProtectedRoute from'./ProtectedRoute';import InfoTooltip from'./InfoTooltip';function App(){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),loggedIn=_useState2[0],setLoggedIn=_useState2[1];var history=useHistory();var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),token=_useState4[0],setToken=_useState4[1];useEffect(function(_){tokenCheck();},[]);var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isEditProfilePopupOpen=_useState6[0],setEditProfilePopupOpen=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),isAddPlacePopupOpen=_useState8[0],setAddPlacePopupOpen=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),isEditAvatarPopupOpen=_useState10[0],setEditAvatarPopupOpen=_useState10[1];var _useState11=useState({}),_useState12=_slicedToArray(_useState11,2),selectedCard=_useState12[0],setSelectedCard=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),isCardPopupOpen=_useState14[0],setCardPopupOpen=_useState14[1];var _useState15=useState({}),_useState16=_slicedToArray(_useState15,2),currentUser=_useState16[0],setcurrentUser=_useState16[1];var _useState17=useState([]),_useState18=_slicedToArray(_useState17,2),cards=_useState18[0],getCards=_useState18[1];var _useState19=useState({message:'',success:Boolean,open:false}),_useState20=_slicedToArray(_useState19,2),infoTooltipState=_useState20[0],setInfoTooltipState=_useState20[1];var getCardsState=function getCardsState(token){getInitialCards(token).then(function(data){var items=data.map(function(el){return{_id:el._id,name:el.name,link:el.link,likes:el.likes,owner:el.owner};});getCards(items);}).catch(function(err){return console.log(err);});};// useEffect(() => {\n//   api.getInitialCards()\n//     .then((data) => {\n//       const items = data.map((el) => ({\n//         _id: el._id,\n//         name: el.name,\n//         link: el.link,\n//         likes: el.likes,\n//         owner: el.owner\n//       }))\n//       getCards(items);\n//     })\n//     .catch(err => console.log(err))\n// }, [])\nfunction handleCardClick(card){setCardPopupOpen(true);setSelectedCard(card);}function handleEditProfileClick(){setEditProfilePopupOpen(true);}function handleEditAvatarClick(){setEditAvatarPopupOpen(true);}function handleAddPlaceClick(){setAddPlacePopupOpen(true);}function closeAllPopups(){setEditAvatarPopupOpen(false);setAddPlacePopupOpen(false);setEditProfilePopupOpen(false);setCardPopupOpen(false);setInfoTooltipState({open:false});}function handleCardDelete(id){deleteCard(token,id).then(function(){getCards(cards.filter(function(card){return card._id!==id;}));}).catch(function(err){return console.log(err);});}function handleCardDislike(id){removeLike(token,id).then(function(newCard){var newCards=cards.map(function(c){return c._id===id?newCard:c;});getCards(newCards);}).catch(function(err){return console.log(err);});}function handleCardLike(id){putLike(token,id).then(function(newCard){var newCards=cards.map(function(c){return c._id===id?newCard:c;});getCards(newCards);}).catch(function(err){return console.log(err);});}function handleUpdateUser(newData){patchUserInfo(token,newData).then(function(data){console.log(data);setcurrentUser(data);closeAllPopups();}).catch(function(err){return console.log(err);});}function handleUpdateAvatar(newAvatar){patchAvatar(token,newAvatar).then(function(data){console.log(data);setcurrentUser(data);closeAllPopups();}).catch(function(err){return console.log(err);});}function handleAddPlaceSubmit(newCard){postCard(token,newCard).then(function(data){console.log(data);getCards([].concat(_toConsumableArray(cards),[data]));closeAllPopups();}).catch(function(err){return console.log(err);});}var handleLogin=function handleLogin(email,password){authorize(email,password).then(function(data){if(data.token){localStorage.setItem('jwt',data.token);tokenCheck();}}).catch(function(err){return console.error(err);});};var handleLogout=function handleLogout(){localStorage.removeItem('jwt');setcurrentUser({});setLoggedIn(false);setToken(null);};var handleRegister=function handleRegister(email,password){register(email,password).then(function(data){console.log(data);if(data.data._id){setInfoTooltipState({message:'Вы успешно зарегистрировались!',success:true,open:true});history.push('/sign-in');}}).catch(function(err){console.log(err);setInfoTooltipState({message:'Что-то пошло не так! Попробуйте ещё раз.',success:false,open:true});});};var tokenCheck=function tokenCheck(){var jwt=localStorage.getItem('jwt');if(jwt){setToken(jwt);getContent(jwt).then(function(res){console.log(res);if(res.data.email){setcurrentUser(res.data);setLoggedIn(true);history.push('/');getCardsState(jwt);}}).catch(function(err){localStorage.removeItem('jwt');console.error(err);});}};return/*#__PURE__*/React.createElement(CurrentUserContext.Provider,{value:currentUser},/*#__PURE__*/React.createElement(\"div\",{className:\"page\"},/*#__PURE__*/React.createElement(\"div\",{className:\"page__content\"},/*#__PURE__*/React.createElement(Header,{loggedIn:loggedIn,logout:handleLogout}),/*#__PURE__*/React.createElement(Switch,null,/*#__PURE__*/React.createElement(Route,{exact:true,path:\"/sign-in\"},/*#__PURE__*/React.createElement(Login,{handleLogin:handleLogin})),/*#__PURE__*/React.createElement(Route,{exact:true,path:\"/sign-up\"},/*#__PURE__*/React.createElement(Register,{handleRegister:handleRegister})),/*#__PURE__*/React.createElement(ProtectedRoute,{exact:true,path:\"/\",loggedIn:loggedIn,component:Main,onEditAvatar:handleEditAvatarClick,onEditProfile:handleEditProfileClick,onAddPlace:handleAddPlaceClick,onCardClick:handleCardClick,onCardDelete:handleCardDelete,onCardLike:handleCardLike,onCardDislike:handleCardDislike,cards:cards})),/*#__PURE__*/React.createElement(EditProfilePopup,{isOpen:isEditProfilePopupOpen,onClose:closeAllPopups,onUpdateUser:handleUpdateUser}),/*#__PURE__*/React.createElement(EditAvatarPopup,{isOpen:isEditAvatarPopupOpen,onClose:closeAllPopups,onUpdateAvatar:handleUpdateAvatar}),/*#__PURE__*/React.createElement(AddPlacePopup,{isOpen:isAddPlacePopupOpen,onClose:closeAllPopups,onAddPlace:handleAddPlaceSubmit}),/*#__PURE__*/React.createElement(ImagePopup,{card:selectedCard,isOpen:isCardPopupOpen,onClose:closeAllPopups}),/*#__PURE__*/React.createElement(InfoTooltip,{onClose:closeAllPopups,renderState:infoTooltipState}),/*#__PURE__*/React.createElement(Footer,null))));}export default App;","map":{"version":3,"sources":["/home/dmitrij/dev/react-mesto-api-full/frontend/src/components/App.js"],"names":["React","useState","useEffect","Route","Switch","useHistory","Header","Main","Footer","ImagePopup","EditProfilePopup","EditAvatarPopup","AddPlacePopup","CurrentUserContext","api","Register","Login","register","authorize","getContent","getInitialCards","postCard","patchUserInfo","patchAvatar","putLike","removeLike","deleteCard","ProtectedRoute","InfoTooltip","App","loggedIn","setLoggedIn","history","token","setToken","_","tokenCheck","isEditProfilePopupOpen","setEditProfilePopupOpen","isAddPlacePopupOpen","setAddPlacePopupOpen","isEditAvatarPopupOpen","setEditAvatarPopupOpen","selectedCard","setSelectedCard","isCardPopupOpen","setCardPopupOpen","currentUser","setcurrentUser","cards","getCards","message","success","Boolean","open","infoTooltipState","setInfoTooltipState","getCardsState","then","data","items","map","el","_id","name","link","likes","owner","catch","err","console","log","handleCardClick","card","handleEditProfileClick","handleEditAvatarClick","handleAddPlaceClick","closeAllPopups","handleCardDelete","id","filter","handleCardDislike","newCard","newCards","c","handleCardLike","handleUpdateUser","newData","handleUpdateAvatar","newAvatar","handleAddPlaceSubmit","handleLogin","email","password","localStorage","setItem","error","handleLogout","removeItem","handleRegister","push","jwt","getItem","res"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { Route, Switch, useHistory } from 'react-router-dom';\nimport Header from './Header';\nimport Main from './Main';\nimport Footer from './Footer';\nimport ImagePopup from './ImagePopup'\nimport EditProfilePopup from './EditProfilePopup'\nimport EditAvatarPopup from './EditAvatarPopup'\nimport AddPlacePopup from './AddPlacePopup'\nimport { CurrentUserContext } from '../contexts/CurrentUserContext'\nimport api from '../utils/Api'\nimport Register from './Register';\nimport Login from './Login';\nimport { register, authorize, getContent, getInitialCards, postCard, patchUserInfo, patchAvatar, putLike, removeLike, deleteCard } from '../auth';\nimport ProtectedRoute from './ProtectedRoute';\nimport InfoTooltip from './InfoTooltip';\n\nfunction App() {\n\n  const [loggedIn, setLoggedIn] = useState(false)\n  const history = useHistory();\n  const [token, setToken] = useState('')\n\n  useEffect(_ => {\n    tokenCheck()\n  }, [])\n\n  const [isEditProfilePopupOpen, setEditProfilePopupOpen] = useState(false)\n  const [isAddPlacePopupOpen, setAddPlacePopupOpen] = useState(false)\n  const [isEditAvatarPopupOpen, setEditAvatarPopupOpen] = useState(false)\n  const [selectedCard, setSelectedCard] = useState({});\n  const [isCardPopupOpen, setCardPopupOpen] = useState(false)\n  const [currentUser, setcurrentUser] = useState({})\n  const [cards, getCards] = useState([])\n  const [infoTooltipState, setInfoTooltipState] = useState({\n    message: '',\n    success: Boolean,\n    open: false\n  });\n\n\n  const getCardsState = (token) => {\n    getInitialCards(token)\n      .then((data) => {\n        const items = data.map((el) => ({\n          _id: el._id,\n          name: el.name,\n          link: el.link,\n          likes: el.likes,\n          owner: el.owner\n        }))\n        getCards(items);\n      })\n      .catch(err => console.log(err))\n  }\n\n  // useEffect(() => {\n  //   api.getInitialCards()\n  //     .then((data) => {\n  //       const items = data.map((el) => ({\n  //         _id: el._id,\n  //         name: el.name,\n  //         link: el.link,\n  //         likes: el.likes,\n  //         owner: el.owner\n  //       }))\n  //       getCards(items);\n  //     })\n  //     .catch(err => console.log(err))\n  // }, [])\n\n  function handleCardClick(card) {\n    setCardPopupOpen(true)\n    setSelectedCard(card)\n  }\n\n  function handleEditProfileClick() {\n    setEditProfilePopupOpen(true)\n  }\n\n  function handleEditAvatarClick() {\n    setEditAvatarPopupOpen(true)\n  }\n\n  function handleAddPlaceClick() {\n    setAddPlacePopupOpen(true)\n  }\n\n  function closeAllPopups() {\n    setEditAvatarPopupOpen(false)\n    setAddPlacePopupOpen(false)\n    setEditProfilePopupOpen(false)\n    setCardPopupOpen(false)\n    setInfoTooltipState({\n      open: false\n    })\n  }\n\n  function handleCardDelete(id) {\n    deleteCard(token, id)\n      .then(() => {\n        getCards(cards.filter(card => card._id !== id))\n      })\n      .catch(err => console.log(err))\n  }\n\n  function handleCardDislike(id) {\n    removeLike(token, id)\n      .then((newCard) => {\n        const newCards = cards.map((c) => c._id === id ? newCard : c);\n        getCards(newCards);\n      })\n      .catch(err => console.log(err))\n  }\n\n  function handleCardLike(id) {\n    putLike(token, id)\n      .then((newCard) => {\n        const newCards = cards.map((c) => c._id === id ? newCard : c);\n        getCards(newCards);\n      })\n      .catch(err => console.log(err))\n  }\n\n  function handleUpdateUser(newData) {\n    patchUserInfo(token, newData)\n      .then((data) => {\n        console.log(data)\n        setcurrentUser(data)\n        closeAllPopups()\n      })\n      .catch(err => console.log(err))\n  }\n\n  function handleUpdateAvatar(newAvatar) {\n    patchAvatar(token, newAvatar)\n      .then((data) => {\n        console.log(data)\n        setcurrentUser(data)\n        closeAllPopups()\n      })\n      .catch(err => console.log(err))\n  }\n\n  function handleAddPlaceSubmit(newCard) {\n    postCard(token, newCard)\n      .then((data) => {\n        console.log(data)\n        getCards([...cards, data]);\n        closeAllPopups()\n      })\n      .catch(err => console.log(err))\n  }\n\n  const handleLogin = (email, password) => {\n    authorize(email, password)\n      .then(data => {\n        if (data.token) {\n          localStorage.setItem('jwt', data.token)\n          tokenCheck()\n        }\n      })\n      .catch(err => console.error(err))\n  }\n\n  const handleLogout = () => {\n    localStorage.removeItem('jwt');\n    setcurrentUser({})\n    setLoggedIn(false)\n    setToken(null)\n  }\n\n  const handleRegister = (email, password) => {\n    register(email, password)\n      .then(data => {\n        console.log(data)\n        if (data.data._id) {\n          setInfoTooltipState({\n            message: 'Вы успешно зарегистрировались!',\n            success: true,\n            open: true\n          })\n          history.push('/sign-in')\n        }\n      })\n      .catch(err => {\n        console.log(err)\n        setInfoTooltipState({\n          message: 'Что-то пошло не так! Попробуйте ещё раз.',\n          success: false,\n          open: true\n        })\n      })\n  }\n\n  const tokenCheck = () => {\n    const jwt = localStorage.getItem('jwt');\n    if (jwt) {\n      setToken(jwt)\n      getContent(jwt)\n        .then((res) => {\n          console.log(res)\n          if (res.data.email) {\n            setcurrentUser(res.data)\n            setLoggedIn(true)\n            history.push('/')\n            getCardsState(jwt)\n          }\n        }).catch(err => {\n          localStorage.removeItem('jwt')\n          console.error(err)\n        })\n    }\n  }\n\n  return (\n    <CurrentUserContext.Provider value={currentUser}>\n      <div className='page'>\n        <div className=\"page__content\">\n          <Header\n            loggedIn={loggedIn}\n\n            logout={handleLogout}\n          />\n          <Switch>\n            <Route exact path=\"/sign-in\">\n              <Login handleLogin={handleLogin} />\n            </Route>\n            <Route exact path=\"/sign-up\">\n              <Register handleRegister={handleRegister} />\n            </Route>\n            <ProtectedRoute exact path=\"/\"\n              loggedIn={loggedIn}\n              component={Main}\n              onEditAvatar={handleEditAvatarClick}\n              onEditProfile={handleEditProfileClick}\n              onAddPlace={handleAddPlaceClick}\n              onCardClick={handleCardClick}\n              onCardDelete={handleCardDelete}\n              onCardLike={handleCardLike}\n              onCardDislike={handleCardDislike}\n              cards={cards}\n            />\n          </Switch>\n          <EditProfilePopup\n            isOpen={isEditProfilePopupOpen}\n            onClose={closeAllPopups}\n            onUpdateUser={handleUpdateUser}\n          />\n          <EditAvatarPopup\n            isOpen={isEditAvatarPopupOpen}\n            onClose={closeAllPopups}\n            onUpdateAvatar={handleUpdateAvatar}\n          />\n          <AddPlacePopup\n            isOpen={isAddPlacePopupOpen}\n            onClose={closeAllPopups}\n            onAddPlace={handleAddPlaceSubmit}\n          />\n          <ImagePopup\n            card={selectedCard}\n            isOpen={isCardPopupOpen}\n            onClose={closeAllPopups}\n          />\n          <InfoTooltip\n            onClose={closeAllPopups}\n            renderState={infoTooltipState}\n          />\n          <Footer />\n        </div>\n      </div>\n    </CurrentUserContext.Provider>\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}